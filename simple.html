<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ISK vs VP Calculator</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
</head>
<body>
    <div id="app" class="container my-4">
        <h1 class="mb-4">ISK vs VP Calculator</h1>

        <!-- Input Section (Rows 1-10) -->
        <div class="card mb-4">
            <div class="card-header">
                <h3>Input Parameters</h3>
            </div>
            <div class="card-body">
                <div class="row g-3">
                    <div class="col-md-6">
                        <label class="form-label">Initialt kapital</label>
                        <input type="number" class="form-control" v-model.number="initialCapital">
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Utveckling (per år)</label>
                        <input type="number" step="0.01" class="form-control" v-model.number="development">
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Uttag ISK</label>
                        <input type="number" step="0.01" class="form-control" v-model.number="withdrawalISK">
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Uttag VP</label>
                        <input type="number" step="0.01" class="form-control" v-model.number="withdrawalVP">
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">ISK-skattesats</label>
                        <input type="number" step="0.0001" class="form-control" v-model.number="iskTaxRate">
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Inflationstakt</label>
                        <input type="number" step="0.01" class="form-control" v-model.number="inflationRate">
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Vinstskatt</label>
                        <input type="number" step="0.01" class="form-control" v-model.number="capitalGainsTax">
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Startår</label>
                        <input type="number" class="form-control" v-model.number="startYear">
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Slutvärden (år senare)</label>
                        <input type="number" class="form-control" v-model.number="yearsLater" min="1" max="100">
                    </div>
                </div>
            </div>
        </div>

        <!-- Summary Section (Rows 11-15) -->
        <div class="card mb-4">
            <div class="card-header">
                <h3>Summary</h3>
            </div>
            <div class="card-body">
                <table class="table table-bordered">
                    <thead>
                        <tr>
                            <th></th>
                            <th>ISK</th>
                            <th>VP</th>
                            <th>Fördel ISK</th>
                            <th>Fördel ISK %</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>Likvidbelopp</strong></td>
                            <td>{{ formatNumber(summary.liquidValueISK) }}</td>
                            <td>{{ formatNumber(summary.liquidValueVP) }}</td>
                            <td>{{ formatNumber(summary.liquidValueDiff) }}</td>
                            <td>{{ formatPercent(summary.liquidValueDiffPercent) }}</td>
                        </tr>
                        <tr>
                            <td><strong>Betald skatt</strong></td>
                            <td>{{ formatNumber(summary.paidTaxISK) }}</td>
                            <td>{{ formatNumber(summary.paidTaxVP) }}</td>
                            <td>{{ formatNumber(summary.paidTaxDiff) }}</td>
                            <td>{{ formatPercent(summary.paidTaxDiffPercent) }}</td>
                        </tr>
                        <tr>
                            <td><strong>Beskattningsgrad</strong></td>
                            <td>{{ formatPercent(summary.taxationDegreeISK) }}</td>
                            <td>{{ formatPercent(summary.taxationDegreeVP) }}</td>
                            <td>{{ formatPercent(summary.taxationDegreeDiff) }}</td>
                            <td>{{ formatPercent(summary.taxationDegreeDiffPercent) }}</td>
                        </tr>
                        <tr>
                            <td><strong>Uttag reellt</strong></td>
                            <td>{{ formatNumber(summary.realWithdrawalISK) }}</td>
                            <td>{{ formatNumber(summary.realWithdrawalVP) }}</td>
                            <td>{{ formatNumber(summary.realWithdrawalDiff) }}</td>
                            <td>{{ formatPercent(summary.realWithdrawalDiffPercent) }}</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Year-by-Year Table (Row 18+) -->
        <div class="card">
            <div class="card-header">
                <h3>Year-by-Year Details</h3>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-sm table-bordered table-hover">
                        <thead class="table-light">
                            <tr>
                                <th>År</th>
                                <th>Utveckling</th>
                                <th>Uttag ISK</th>
                                <th>Uttag VP</th>
                                <th>ISK-skatt</th>
                                <th>Inflationstakt</th>
                                <th>Vinstskatt</th>
                                <th>Belopp ISK</th>
                                <th>Belopp VP</th>
                                <th>Uttaget ISK</th>
                                <th>Uttaget VP</th>
                                <th>Skatteunderlag VP</th>
                                <th>Skatt ISK</th>
                                <th>Skatt VP</th>
                                <th>Framtida skatt VP</th>
                                <th>VP Likvidvärde</th>
                                <th>Betald skatt ISK</th>
                                <th>Betald skatt VP</th>
                                <th>Beskattningsgrad ISK</th>
                                <th>Beskattningsgrad VP</th>
                                <th>Inflation</th>
                                <th>ISK-VP</th>
                                <th>ISK-VP Real</th>
                                <th>Uttaget ISK Real</th>
                                <th>Uttaget VP Real</th>
                                <th>Fördel ISK %</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr v-for="row in yearlyData" :key="row.year">
                                <td>{{ row.year }}</td>
                                <td>{{ formatPercent(row.development) }}</td>
                                <td>{{ formatPercent(row.withdrawalISK) }}</td>
                                <td>{{ formatPercent(row.withdrawalVP) }}</td>
                                <td>{{ formatPercent(row.iskTaxRate) }}</td>
                                <td>{{ formatPercent(row.inflationRate) }}</td>
                                <td>{{ formatPercent(row.capitalGainsTax) }}</td>
                                <td>{{ formatNumber(row.amountISK) }}</td>
                                <td>{{ formatNumber(row.amountVP) }}</td>
                                <td>{{ formatNumber(row.withdrawnISK) }}</td>
                                <td>{{ formatNumber(row.withdrawnVP) }}</td>
                                <td>{{ formatNumber(row.taxBasisVP) }}</td>
                                <td>{{ formatNumber(row.taxISK) }}</td>
                                <td>{{ formatNumber(row.taxVP) }}</td>
                                <td>{{ formatNumber(row.futureTaxVP) }}</td>
                                <td>{{ formatNumber(row.vpLiquidValue) }}</td>
                                <td>{{ formatNumber(row.paidTaxISK) }}</td>
                                <td>{{ formatNumber(row.paidTaxVP) }}</td>
                                <td>{{ formatPercent(row.taxationDegreeISK) }}</td>
                                <td>{{ formatPercent(row.taxationDegreeVP) }}</td>
                                <td>{{ formatPercent(row.inflation) }}</td>
                                <td>{{ formatNumber(row.iskMinusVP) }}</td>
                                <td>{{ formatNumber(row.iskMinusVPReal) }}</td>
                                <td>{{ formatNumber(row.withdrawnISKReal) }}</td>
                                <td>{{ formatNumber(row.withdrawnVPReal) }}</td>
                                <td>{{ formatPercent(row.advantageISKPercent) }}</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>
        const { createApp } = Vue;

        createApp({
            data() {
                return {
                    // Input fields (rows 1-10)
                    initialCapital: 80000000,
                    development: 0.08,
                    withdrawalISK: 0.03,
                    withdrawalVP: 0.03,
                    iskTaxRate: 0.0296,
                    inflationRate: 0.02,
                    capitalGainsTax: 0.3,
                    startYear: 45,
                    yearsLater: 36
                };
            },
            computed: {
                yearlyData() {
                    const data = [];
                    let amountISK = this.initialCapital;
                    let amountVP = this.initialCapital;
                    let capitalGainVP = 0;
                    let cumulativePaidTaxISK = 0;
                    let cumulativePaidTaxVP = 0;
                    let cumulativeInflation = 0;

                    for (let i = 0; i < this.yearsLater; i++) {
                        const year = this.startYear + i;

                        // Calculate withdrawals
                        const withdrawnISK = amountISK * this.withdrawalISK;
                        const withdrawnVP = amountVP * this.withdrawalVP;

                        // Calculate capital gain for VP
                        const newCapitalGainVP = amountVP * (1 + this.development) - this.initialCapital;

                        // Calculate ISK tax
                        const taxISK = amountISK * this.iskTaxRate * this.capitalGainsTax;

                        // Calculate VP tax (on withdrawal and capital gain)
                        const taxVP = newCapitalGainVP * this.withdrawalISK * this.capitalGainsTax;

                        // Calculate future tax VP
                        const futureTaxVP = newCapitalGainVP * this.capitalGainsTax;

                        // Update cumulative taxes
                        cumulativePaidTaxISK += taxISK;
                        cumulativePaidTaxVP += taxVP;

                        // Calculate VP liquid value (after future tax)
                        const vpLiquidValue = amountVP - futureTaxVP / (1 + this.development);

                        // Calculate cumulative inflation
                        if (i === 0) {
                            cumulativeInflation = 1 + this.inflationRate;
                        } else {
                            cumulativeInflation *= (1 + this.inflationRate);
                        }

                        // Real values adjusted for inflation
                        const withdrawnISKReal = withdrawnISK / cumulativeInflation;
                        const withdrawnVPReal = withdrawnVP / cumulativeInflation;
                        const iskMinusVP = amountISK - vpLiquidValue;
                        const iskMinusVPReal = iskMinusVP / cumulativeInflation;

                        data.push({
                            year,
                            development: this.development,
                            withdrawalISK: this.withdrawalISK,
                            withdrawalVP: this.withdrawalVP,
                            iskTaxRate: this.iskTaxRate,
                            inflationRate: this.inflationRate,
                            capitalGainsTax: this.capitalGainsTax,
                            amountISK,
                            amountVP,
                            withdrawnISK,
                            withdrawnVP,
                            taxBasisVP: newCapitalGainVP,
                            taxISK,
                            taxVP,
                            futureTaxVP,
                            vpLiquidValue,
                            paidTaxISK: cumulativePaidTaxISK,
                            paidTaxVP: cumulativePaidTaxVP,
                            taxationDegreeISK: cumulativePaidTaxISK / amountISK,
                            taxationDegreeVP: cumulativePaidTaxVP / vpLiquidValue,
                            inflation: cumulativeInflation,
                            iskMinusVP,
                            iskMinusVPReal,
                            withdrawnISKReal,
                            withdrawnVPReal,
                            advantageISKPercent: iskMinusVP / vpLiquidValue
                        });

                        // Update amounts for next year
                        amountISK = amountISK * (1 + this.development - this.withdrawalISK - this.iskTaxRate);
                        amountVP = amountVP * (1 + this.development - this.withdrawalVP);
                        capitalGainVP = newCapitalGainVP;
                    }

                    return data;
                },
                summary() {
                    if (this.yearlyData.length === 0) {
                        return {
                            liquidValueISK: 0,
                            liquidValueVP: 0,
                            liquidValueDiff: 0,
                            liquidValueDiffPercent: 0,
                            paidTaxISK: 0,
                            paidTaxVP: 0,
                            paidTaxDiff: 0,
                            paidTaxDiffPercent: 0,
                            taxationDegreeISK: 0,
                            taxationDegreeVP: 0,
                            taxationDegreeDiff: 0,
                            taxationDegreeDiffPercent: 0,
                            realWithdrawalISK: 0,
                            realWithdrawalVP: 0,
                            realWithdrawalDiff: 0,
                            realWithdrawalDiffPercent: 0
                        };
                    }

                    const lastYear = this.yearlyData[this.yearlyData.length - 1];

                    const liquidValueISK = lastYear.amountISK;
                    const liquidValueVP = lastYear.vpLiquidValue;
                    const liquidValueDiff = liquidValueISK - liquidValueVP;
                    const liquidValueDiffPercent = liquidValueDiff / liquidValueISK;

                    const paidTaxISK = lastYear.paidTaxISK;
                    const paidTaxVP = lastYear.paidTaxVP;
                    const paidTaxDiff = paidTaxVP - paidTaxISK;
                    const paidTaxDiffPercent = paidTaxDiff / paidTaxISK;

                    const taxationDegreeISK = paidTaxISK / liquidValueISK;
                    const taxationDegreeVP = paidTaxVP / liquidValueVP;
                    const taxationDegreeDiff = taxationDegreeVP - taxationDegreeISK;
                    const taxationDegreeDiffPercent = taxationDegreeDiff / taxationDegreeISK;

                    const realWithdrawalISK = lastYear.withdrawnISKReal;
                    const realWithdrawalVP = lastYear.withdrawnVPReal;
                    const realWithdrawalDiff = realWithdrawalISK - realWithdrawalVP;
                    const realWithdrawalDiffPercent = realWithdrawalDiff / realWithdrawalISK;

                    return {
                        liquidValueISK,
                        liquidValueVP,
                        liquidValueDiff,
                        liquidValueDiffPercent,
                        paidTaxISK,
                        paidTaxVP,
                        paidTaxDiff,
                        paidTaxDiffPercent,
                        taxationDegreeISK,
                        taxationDegreeVP,
                        taxationDegreeDiff,
                        taxationDegreeDiffPercent,
                        realWithdrawalISK,
                        realWithdrawalVP,
                        realWithdrawalDiff,
                        realWithdrawalDiffPercent
                    };
                }
            },
            methods: {
                formatNumber(value) {
                    if (value == null || isNaN(value)) return '-';
                    return new Intl.NumberFormat('sv-SE', {
                        minimumFractionDigits: 2,
                        maximumFractionDigits: 2
                    }).format(value);
                },
                formatPercent(value) {
                    if (value == null || isNaN(value)) return '-';
                    return new Intl.NumberFormat('sv-SE', {
                        style: 'percent',
                        minimumFractionDigits: 2,
                        maximumFractionDigits: 4
                    }).format(value);
                }
            }
        }).mount('#app');
    </script>
</body>
</html>
